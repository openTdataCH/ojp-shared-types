openapi: 3.0.3
info:
  title: XML OJP 2.0 API
  description: API that returns trip data in XML format.
  version: 0.0.1

servers:
  - url: https://api.example.com

paths:
  /ojp:
    post:
      summary: Main /ojp endpoint
      description: Main /ojp endpoint
      responses:
        "200":
          description: Successful response
          content:
            application/xml:
              schema:
                $ref: "#/components/schemas/OJP"
        "500":
          description: Server error

components:
  schemas:
    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__LegBoardStructure
    LegBoard:
      type: object
      xml:
        name: LegBoard
      allOf:
        - $ref: './ojp-shared.yml#/components/schemas/CallAtStop'
      required:
        - stopPointRef
        - stopPointName
        - serviceDeparture

    LegIntermediate:
      type: object
      xml:
        name: LegIntermediate
      allOf:
        - $ref: './ojp-shared.yml#/components/schemas/CallAtStop'
      required:
        - stopPointRef
        - stopPointName
        - serviceArrival
        - serviceDeparture

    LegAlight:
      type: object
      xml:
        name: LegAlight
      allOf:
        - $ref: './ojp-shared.yml#/components/schemas/CallAtStop'
      required:
        - stopPointRef
        - stopPointName
        - serviceArrival
    
    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__PathGuidanceSectionStructure
    PathGuidanceSectionStructure:
      type: object
      xml:
        name: PathGuidanceSection
      properties:
        trackSection:
          $ref: './ojp-shared.yml#/components/schemas/TrackSectionStructure'
          xml:
            name: TrackSection
        turnDescription:
          $ref: './ojp-shared.yml#/components/schemas/InternationalText'
          xml:
            name: TurnDescription
        guidanceAdvice:
          # TODO - make it enum
          # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__GuidanceAdviceEnumeration
          type: string
          xml:
            name: GuidanceAdvice
        turnAction:
          # TODO - make it enum
          # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__TurnActionEnumeration
          type: string
          xml:
            name: TurnAction
        roadName:
          $ref: './ojp-shared.yml#/components/schemas/InternationalText'
          xml:
            name: TurnDescription

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__PathGuidanceStructure
    PathGuidanceStructure:
      type: object
      xml:
        name: PathGuidance
      required:
        - pathGuidanceSection
      properties:
        pathGuidanceSection:
          type: array
          xml:
            name: PathGuidanceSection
          items:
            $ref: '#/components/schemas/PathGuidanceSectionStructure'

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__TimedLegStructure
    TimedLeg:
      type: object
      xml:
        name: TimedLeg
      required:
        - legBoard
        - legIntermediate
        - legAlight
        - service
      properties:
        legBoard:
          $ref: '#/components/schemas/LegBoard'
          xml:
            name: LegBoard
        legIntermediate:
          type: array
          xml:
            name: LegIntermediate
          items:
            $ref: "#/components/schemas/LegIntermediate"
        legAlight:
          $ref: '#/components/schemas/LegAlight'
          xml:
            name: LegAlight
        service:
          $ref: './ojp-shared.yml#/components/schemas/DatedJourney'
          xml:
            name: Service
        legTrack:
          $ref: './ojp-shared.yml#/components/schemas/LegTrackStructure'
          xml:
            name: LegTrack
    # TimedLeg

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__TransferLegStructure
    TransferLeg:
      type: object
      xml:
        name: TransferLeg
      required:
        - transferType
        - legStart
        - legEnd
        - duration
      properties:
        transferType:
          $ref: "./ojp-shared.yml#/components/schemas/TransferTypeEnum"
          xml:
            name: TransferType
        legStart:
          $ref: './ojp-shared.yml#/components/schemas/PlaceRef'
          xml:
            name: LegStart
        legEnd:
          $ref: './ojp-shared.yml#/components/schemas/PlaceRef'
          xml:
            name: LegEnd
        duration:
          type: string
          xml:
            name: Duration
        length:
          type: number
          xml:
            name: Length
        pathGuidance:
          $ref: '#/components/schemas/PathGuidanceStructure'
          xml:
            name: PathGuidance

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__ContinuousLegStructure
    ContinuousLeg:
      type: object
      xml:
        name: ContinuousLeg
      required:
        - legStart
        - legEnd
        - service
        - duration
      properties:
        legStart:
          $ref: './ojp-shared.yml#/components/schemas/PlaceRef'
          xml:
            name: LegStart
        legEnd:
          $ref: './ojp-shared.yml#/components/schemas/PlaceRef'
          xml:
            name: LegEnd
        service:
          $ref: './ojp-shared.yml#/components/schemas/ContinuousServiceStructure'
          xml:
            name: Service
        duration:
          type: string
          xml:
            name: Duration
        length:
          type: number
          xml:
            name: Length
        legTrack:
          $ref: './ojp-shared.yml#/components/schemas/LegTrackStructure'
          xml:
            name: LegTrack
        pathGuidance:
          $ref: '#/components/schemas/PathGuidanceStructure'
          xml:
            name: PathGuidance

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__LegStructure
    Leg:
      type: object
      xml:
        name: Leg
      required:
        - id
      properties:
        id:
          type: string
          xml:
            name: Id
        duration:
          type: string
          xml:
            name: Duration
        # Using oneOf requires additional boilerplate code, use optionals instead
        timedLeg:
          $ref: '#/components/schemas/TimedLeg'
          xml:
            name: TimedLeg
        transferLeg:
          $ref: '#/components/schemas/TransferLeg'
          xml:
            name: TransferLeg
        continuousLeg:
          $ref: '#/components/schemas/ContinuousLeg'
          xml:
            name: ContinuousLeg
        emissionCO2:
          type: object
          xml:
            name: EmissionCO2
          required:
            - kilogramPerPersonKm
          properties:
            kilogramPerPersonKm:
              type: number
              xml:
                name: KilogramPerPersonKm

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__TripStructure
    Trip:
      type: object
      xml:
        name: Trip
      required:
        - id
        - duration
        - startTime
        - endTime
        - transfers
        - leg
      properties:
        id:
          type: string
          xml:
            name: Id
        duration:
          type: string
          xml:
            name: Duration
        startTime:
          type: string
          format: date-time
          xml:
            name: StartTime
        endTime:
          type: string
          format: date-time
          xml:
            name: EndTime
        transfers:
          type: number
          xml:
            name: Transfers
        distance:
          type: number
          xml:
            name: Distance
        leg:
          type: array
          xml:
            name: Leg
          items:
            $ref: "#/components/schemas/Leg"
        unplanned: 
          type: boolean
          xml:
            name: Unplanned
        cancelled: 
          type: boolean
          xml:
            name: Cancelled
        deviation: 
          type: boolean
          xml:
            name: Deviation
        delayed: 
          type: boolean
          xml:
            name: delayed
        infeasible: 
          type: boolean
          xml:
            name: Infeasible

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__TripResultStructure
    TripResult:
      type: object
      xml:
        name: TripResult
      required:
        - id
        - trip
      properties:
        id:
          type: string
          xml:
            name: Id
        trip:
          $ref: '#/components/schemas/Trip'
          xml:
            name: Trip

    # https://vdvde.github.io/OJP/develop/documentation-tables/ojp.html#type_ojp__OJPTripDeliveryStructure
    OJPTripDelivery:
      type: object
      xml:
        name: OJPTripDelivery
      required:
        - responseTimestamp
        - tripResult
      properties:
        responseTimestamp:
          type: string
          xml:
            name: ResponseTimestamp
            namespace: "http://www.siri.org.uk/siri"
            prefix: siri
        requestMessageRef:
          type: string
          xml:
            name: RequestMessageRef
            namespace: "http://www.siri.org.uk/siri"
            prefix: siri
        defaultLanguage:
          type: string
          xml:
            name: DefaultLanguage
            namespace: "http://www.siri.org.uk/siri"
            prefix: siri
        calcTime:
          type: string
          xml:
            name: CalcTime
        tripResponseContext:
          $ref: './ojp-shared.yml#/components/schemas/ResponseContextStructure'
          xml:
            name: TripResponseContext
        tripResult:
          type: array
          xml:
            name: TripResult
          items:
            $ref: "#/components/schemas/TripResult"

    OJP:
      type: object
      xml:
        name: OJP
      required:
        - OJPResponse
      properties:
        OJPResponse:
          type: object
          xml:
            name: OJPResponse
          required:
            - serviceDelivery
          properties:
            serviceDelivery:
              type: object
              xml:
                name: ServiceDelivery
                namespace: "http://www.siri.org.uk/siri"
                prefix: siri
              required:
                - responseTimestamp
                - producerRef
                - OJPTripDelivery
              properties:
                responseTimestamp:
                  type: string
                  xml:
                    name: ResponseTimestamp
                    namespace: "http://www.siri.org.uk/siri"
                    prefix: siri
                producerRef:
                  type: string
                  xml:
                    name: ProducerRef
                    namespace: "http://www.siri.org.uk/siri"
                    prefix: siri
                OJPTripDelivery:
                  $ref: '#/components/schemas/OJPTripDelivery'
                  xml:
                    name: OJPTripDelivery
    # OJP
        